<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</title>

<style>
body{
  font-family: Tahoma;
  background:#f4f9f4;
  margin:0;
  padding:15px;
  text-align:center;
}
.header{
  background:#1b5e20;
  color:#fff;
  padding:20px;
  border-radius:20px;
}
.card{
  background:#fff;
  margin:12px 0;
  padding:15px;
  border-radius:18px;
  box-shadow:0 3px 10px rgba(0,0,0,.1);
}
button,select,input{
  padding:10px;
  margin:5px 0;
  border-radius:12px;
  border:1px solid #1b5e20;
  width:90%;
  max-width:300px;
}
.countdown{
  margin:15px 0;
  font-size:18px;
  color:#1b5e20;
}
.prayer{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
  <h2>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h2>
  <p>
    ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© Ù„Ø±ÙˆØ­ Ù…Ù†Ù‰ Ù†Ø§Ø¬ÙŠ Ø¹Ù„ÙŠ Ø£Ø­Ù…Ø¯<br>
    Ø±Ø­Ù…Ù‡Ø§ Ø§Ù„Ù„Ù‡ Ø±Ø­Ù…Ø©Ù‹ ÙˆØ§Ø³Ø¹Ø© ğŸ¤<br>
    <small>Ø§Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø®Ù„Øµ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯</small>
  </p>
  <p id="status">ğŸ“ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</p>
</div>

<!-- GPS -->
<button onclick="getLocation()">ğŸ“ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ (GPS)</button>

<!-- Manual -->
<div class="card">
  <h4>ğŸ“Œ ØªØ­Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</h4>

  <select id="country">
    <option value="EG">Ù…ØµØ±</option>
    <option value="SA">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
    <option value="DZ">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
    <option value="MA">Ø§Ù„Ù…ØºØ±Ø¨</option>
    <option value="JO">Ø§Ù„Ø£Ø±Ø¯Ù†</option>
    <option value="IQ">Ø§Ù„Ø¹Ø±Ø§Ù‚</option>
  </select>

  <input type="text" id="city" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">

  <button onclick="manualLocation()">âœ”ï¸ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</button>
</div>

<div class="countdown" id="countdown"></div>
<div id="prayers"></div>

<script>
const prayerNames={
  Fajr:'Ø§Ù„ÙØ¬Ø±',
  Dhuhr:'Ø§Ù„Ø¸Ù‡Ø±',
  Asr:'Ø§Ù„Ø¹ØµØ±',
  Maghrib:'Ø§Ù„Ù…ØºØ±Ø¨',
  Isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡'
};

function getLocation(){
  document.getElementById("status").innerText="â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
  navigator.geolocation.getCurrentPosition(
    pos=>{
      loadByCoords(pos.coords.latitude,pos.coords.longitude);
    },
    ()=>{
      document.getElementById("status").innerText="âŒ ÙØ´Ù„ GPS â€“ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ";
    }
  );
}

async function loadByCoords(lat,lon){
  document.getElementById("status").innerText="âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§";
  const res=await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=5`);
  const data=await res.json();
  showTimings(data.data.timings);
}

async function manualLocation(){
  const city=document.getElementById("city").value.trim();
  const country=document.getElementById("country").value;
  if(!city){
    alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©");
    return;
  }
  document.getElementById("status").innerText="ğŸ“ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠÙ‹Ø§";
  const res=await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=5`);
  const data=await res.json();
  showTimings(data.data.timings);
}

function showTimings(t){
  let html='';
  let now=new Date();
  let nextTime=null;
  let nextName='';

  for(let k in prayerNames){
    let [h,m]=t[k].split(':');
    let pt=new Date();
    pt.setHours(h,m,0);

    if(pt>now && !nextTime){
      nextTime=pt;
      nextName=prayerNames[k];
    }

    html+=`
    <div class="card prayer">
      <span>${prayerNames[k]}</span>
      <span>${t[k]}</span>
    </div>`;
  }

  document.getElementById("prayers").innerHTML=html;
  startCountdown(nextTime,nextName);
}

function startCountdown(time,name){
  setInterval(()=>{
    if(!time) return;
    let diff=time-new Date();
    if(diff<0) return;
    let h=Math.floor(diff/3600000);
    let m=Math.floor((diff%3600000)/60000);
    let s=Math.floor((diff%60000)/1000);
    document.getElementById("countdown").innerText=
      `Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${name} Ø¨Ø¹Ø¯ ${h}:${m}:${s}`;
  },1000);
}
</script>

</body>
</html>
