<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</title>

<style>
body{
  font-family:Tahoma,Arial;
  background:#f3f8f3;
  margin:0;
  padding:15px;
}
.sadaqa{
  background:#e8f5e9;
  padding:15px;
  border-radius:12px;
  text-align:center;
  margin-bottom:15px;
  color:#1b5e20;
  font-weight:bold;
}
.header{
  background:#1b5e20;
  color:#fff;
  padding:20px;
  border-radius:15px;
  text-align:center;
  font-size:22px;
  margin-bottom:15px;
}
select,button{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:12px;
  margin-bottom:10px;
}
button{
  background:#2e7d32;
  color:#fff;
  border:none;
}
.prayer{
  background:#fff;
  padding:12px;
  border-radius:12px;
  margin-bottom:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.toggle{
  transform:scale(1.3);
}
</style>
</head>

<body>

<div class="sadaqa">
ğŸ¤ ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© Ù„Ø±ÙˆØ­<br>
<strong>Ù…Ù†Ù‰ Ù†Ø§Ø¬ÙŠ Ø¹Ù„ÙŠ</strong><br>
Ø±Ø­Ù…Ù‡Ø§ Ø§Ù„Ù„Ù‡ Ø±Ø­Ù…Ø©Ù‹ ÙˆØ§Ø³Ø¹Ø©
</div>

<div class="header">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</div>

<select id="adhanSelect">
  <option value="adhan-makkah.mp3">Ø£Ø°Ø§Ù† Ù…ÙƒØ©</option>
  <option value="adhan-madina.mp3">Ø£Ø°Ø§Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
  <option value="adhan-short.mp3">Ø£Ø°Ø§Ù† Ù‚ØµÙŠØ±</option>
</select>

<button onclick="saveAdhan()">ğŸ’¾ Ø­ÙØ¸ ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù†</button>
<button onclick="getLocation()">ğŸ“ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ</button>

<audio id="adhan"></audio>

<div id="prayers"></div>

<script>
const prayerNames = {
  Fajr:"Ø§Ù„ÙØ¬Ø±",
  Dhuhr:"Ø§Ù„Ø¸Ù‡Ø±",
  Asr:"Ø§Ù„Ø¹ØµØ±",
  Maghrib:"Ø§Ù„Ù…ØºØ±Ø¨",
  Isha:"Ø§Ù„Ø¹Ø´Ø§Ø¡"
};

const adhan = document.getElementById("adhan");
const select = document.getElementById("adhanSelect");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø®ØªØ§Ø±
const savedSound = localStorage.getItem("adhanSound");
adhan.src = savedSound || select.value;
if(savedSound) select.value = savedSound;

// ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„
let prayerSettings = JSON.parse(localStorage.getItem("prayerSettings")) || {};

function saveAdhan(){
  localStorage.setItem("adhanSound", select.value);
  adhan.src = select.value;
  alert("ØªÙ… Ø­ÙØ¸ ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù†");
}

function getLocation(){
  navigator.geolocation.getCurrentPosition(
    pos => loadTimes(pos.coords.latitude, pos.coords.longitude),
    () => alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹")
  );
}

function loadTimes(lat, lon){
  fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=4`)
    .then(r=>r.json())
    .then(data=>{
      const timings = data.data.timings;
      const container = document.getElementById("prayers");
      container.innerHTML="";

      for(let key in prayerNames){
        if(prayerSettings[key] === undefined)
          prayerSettings[key] = true;

        const div = document.createElement("div");
        div.className="prayer";
        div.innerHTML=`
          <span>${prayerNames[key]} - ${timings[key]}</span>
          <input type="checkbox" class="toggle"
            ${prayerSettings[key] ? "checked":""}
            onchange="togglePrayer('${key}',this.checked)">
        `;
        container.appendChild(div);

        scheduleAdhan(key,timings[key]);
      }
      localStorage.setItem("prayerSettings",JSON.stringify(prayerSettings));
    });
}

function togglePrayer(prayer,value){
  prayerSettings[prayer]=value;
  localStorage.setItem("prayerSettings",JSON.stringify(prayerSettings));
}

function scheduleAdhan(prayer,time){
  if(!prayerSettings[prayer]) return;

  const now = new Date();
  const [h,m]=time.split(":");
  const t=new Date();
  t.setHours(h,m,0);

  const diff=t-now;
  if(diff>0){
    setTimeout(()=>adhan.play(),diff);
  }
}

// Service Worker
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
