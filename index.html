<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</title>

<style>
body{
  font-family: Tahoma;
  background:#f4f9f4;
  margin:0;
  padding:15px;
  text-align:center;
}
.header{
  background:#1b5e20;
  color:#fff;
  padding:20px;
  border-radius:20px;
}
.card{
  background:#fff;
  margin:12px 0;
  padding:15px;
  border-radius:18px;
  box-shadow:0 3px 10px rgba(0,0,0,.1);
}
button{
  padding:12px;
  border-radius:15px;
  border:none;
  background:#1b5e20;
  color:#fff;
  font-size:16px;
  width:90%;
  max-width:300px;
}
.countdown{
  margin:15px 0;
  font-size:18px;
  color:#1b5e20;
}
.prayer{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
  <h2>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h2>
  <p>
    ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© Ù„Ø±ÙˆØ­ Ù…Ù†Ù‰ Ù†Ø§Ø¬ÙŠ Ø¹Ù„ÙŠ Ø£Ø­Ù…Ø¯<br>
    Ø±Ø­Ù…Ù‡Ø§ Ø§Ù„Ù„Ù‡ Ø±Ø­Ù…Ø©Ù‹ ÙˆØ§Ø³Ø¹Ø© ğŸ¤<br>
    <small>Ø§Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø®Ù„Øµ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯</small>
  </p>
  <p id="status">ğŸ“ Ø§Ø¶ØºØ· Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ</p>
</div>

<button onclick="getLocation()">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>

<div class="countdown" id="countdown"></div>
<div id="prayers"></div>

<script>
const prayerNames={
  Fajr:'Ø§Ù„ÙØ¬Ø±',
  Dhuhr:'Ø§Ù„Ø¸Ù‡Ø±',
  Asr:'Ø§Ù„Ø¹ØµØ±',
  Maghrib:'Ø§Ù„Ù…ØºØ±Ø¨',
  Isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡'
};

function getLocation(){
  document.getElementById("status").innerText="â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
  navigator.geolocation.getCurrentPosition(
    pos=>{
      loadTimings(pos.coords.latitude,pos.coords.longitude);
    },
    ()=>{
      document.getElementById("status").innerText=
        "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹ â€“ ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ GPS Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ";
    }
  );
}

async function loadTimings(lat,lon){
  document.getElementById("status").innerText="âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­";
  const res=await fetch(
    `https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=5`
  );
  const data=await res.json();
  showTimings(data.data.timings);
}

function showTimings(t){
  let html='';
  let now=new Date();
  let nextTime=null;
  let nextName='';

  for(let k in prayerNames){
    let [h,m]=t[k].split(':');
    let pt=new Date();
    pt.setHours(h,m,0);

    if(pt>now && !nextTime){
      nextTime=pt;
      nextName=prayerNames[k];
    }

    html+=`
    <div class="card prayer">
      <span>${prayerNames[k]}</span>
      <span>${t[k]}</span>
    </div>`;
  }

  document.getElementById("prayers").innerHTML=html;
  startCountdown(nextTime,nextName);
}

function startCountdown(time,name){
  setInterval(()=>{
    if(!time) return;
    let diff=time-new Date();
    if(diff<0) return;
    let h=Math.floor(diff/3600000);
    let m=Math.floor((diff%3600000)/60000);
    let s=Math.floor((diff%60000)/1000);
    document.getElementById("countdown").innerText=
      `Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${name} Ø¨Ø¹Ø¯ ${h}:${m}:${s}`;
  },1000);
}
</script>

</body>
</html>
