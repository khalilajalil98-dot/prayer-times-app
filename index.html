<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1b5e20">

<style>
body{
  font-family: Tahoma;
  background:#f4f9f4;
  margin:0;
  padding:15px;
  text-align:center;
}
.header{
  background:#1b5e20;
  color:#fff;
  padding:20px;
  border-radius:20px;
}
.sadaqa{
  margin-top:10px;
  font-size:14px;
  color:#e8f5e9;
}
.card{
  background:#fff;
  margin:12px 0;
  padding:15px;
  border-radius:18px;
  box-shadow:0 3px 10px rgba(0,0,0,.1);
}
.prayer{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.prayer-name{
  font-weight:bold;
  color:#1b5e20;
}
.controls{
  display:flex;
  gap:6px;
  justify-content:center;
  margin-top:10px;
}
select,button{
  padding:6px 10px;
  border-radius:10px;
  border:1px solid #1b5e20;
  background:#fff;
}
.countdown{
  margin:15px 0;
  font-size:18px;
  color:#1b5e20;
}
.download{
  background:#1b5e20;
  color:white;
  border:none;
  margin:10px 0;
}
</style>
</head>

<body>

<div class="header">
  <h2>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h2>
  <div class="sadaqa">
    ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© Ù„Ø±ÙˆØ­ Ù…Ù†Ù‰ Ù†Ø§Ø¬ÙŠ  
    <br>Ø±Ø­Ù…Ù‡Ø§ Ø§Ù„Ù„Ù‡ Ø±Ø­Ù…Ø©Ù‹ ÙˆØ§Ø³Ø¹Ø© ğŸ¤
  </div>
  <p id="location">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</p>
</div>

<div class="countdown" id="countdown">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...</div>

<button class="download" onclick="downloadAdhan()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø£ØµÙˆØ§Øª Ø§Ù„Ø£Ø°Ø§Ù†</button>
<p id="downloadStatus"></p>

<div id="prayers"></div>

<audio id="adhan"></audio>

<script>
const prayerNames={
  Fajr:'Ø§Ù„ÙØ¬Ø±',
  Dhuhr:'Ø§Ù„Ø¸Ù‡Ø±',
  Asr:'Ø§Ù„Ø¹ØµØ±',
  Maghrib:'Ø§Ù„Ù…ØºØ±Ø¨',
  Isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡'
};

const adhanSounds=[
 {name:'Ø£Ø°Ø§Ù† Ù…ÙƒØ©',file:'adhan1.mp3'},
 {name:'Ø£Ø°Ø§Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',file:'adhan2.mp3'},
 {name:'Ø£Ø°Ø§Ù† Ø§Ù„Ø­Ø±Ù…',file:'adhan3.mp3'},
 {name:'Ø£Ø°Ø§Ù† Ø§Ù„Ø£Ù‚ØµÙ‰',file:'adhan4.mp3'},
 {name:'Ø£Ø°Ø§Ù† Ù…ØµØ±',file:'adhan5.mp3'},
 {name:'Ø£Ø°Ø§Ù† ØªØ±ÙƒÙŠ',file:'adhan6.mp3'},
 {name:'Ø£Ø°Ø§Ù† Ù…ØºØ±Ø¨ÙŠ',file:'adhan7.mp3'},
 {name:'Ø£Ø°Ø§Ù† Ø­Ø¬Ø§Ø²ÙŠ',file:'adhan8.mp3'},
 {name:'Ø£Ø°Ø§Ù† Ù‡Ø§Ø¯Ø¦',file:'adhan9.mp3'},
 {name:'Ø£Ø°Ø§Ù† Ø§Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠ',file:'adhan10.mp3'}
];

function getLocation(){
 navigator.geolocation.getCurrentPosition(pos=>{
  loadTimings(pos.coords.latitude,pos.coords.longitude);
 },()=>{
  document.getElementById("location").innerText="ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹";
 });
}

async function loadTimings(lat,lon){
 document.getElementById("location").innerText="ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­";
 const res=await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=0`);
 const data=await res.json();
 showTimings(data.data.timings);
}

function showTimings(t){
 let html='';
 let now=new Date();
 let nextTime=null;
 let nextName='';

 for(let k in prayerNames){
  let [h,m]=t[k].split(':');
  let pt=new Date();
  pt.setHours(h,m,0);

  if(pt>now && !nextTime){
    nextTime=pt;
    nextName=prayerNames[k];
    scheduleNotification(nextName,pt,k);
  }

  html+=`
  <div class="card">
    <div class="prayer">
      <div class="prayer-name">${prayerNames[k]}</div>
      <div>${t[k]}</div>
    </div>
    <div class="controls">
      <select onchange="saveSound('${k}',this.value)">
        ${adhanSounds.map(a=>`<option value="${a.file}">${a.name}</option>`).join('')}
      </select>
      <button onclick="toggleMute('${k}')">
        ${localStorage.getItem('mute_'+k)==='yes'?'ğŸ”•':'ğŸ””'}
      </button>
    </div>
  </div>`;
 }
 document.getElementById("prayers").innerHTML=html;
 startCountdown(nextTime,nextName);
}

function saveSound(p,f){
 localStorage.setItem('sound_'+p,f);
}

function toggleMute(p){
 let key='mute_'+p;
 if(localStorage.getItem(key)==='yes'){
  localStorage.removeItem(key);
 }else{
  localStorage.setItem(key,'yes');
 }
 location.reload();
}

function startCountdown(time,name){
 setInterval(()=>{
  let diff=time-new Date();
  if(diff<0) return;
  let h=Math.floor(diff/3600000);
  let m=Math.floor((diff%3600000)/60000);
  let s=Math.floor((diff%60000)/1000);
  document.getElementById("countdown").innerText=
   `Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${name} Ø¨Ø¹Ø¯ ${h}:${m}:${s}`;
 },1000);
}

function scheduleNotification(name,time,p){
 if(Notification.permission!=="granted"){
  Notification.requestPermission();
  return;
 }
 const delay=time-new Date();
 setTimeout(()=>{
  new Notification("ğŸ•Œ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©",{body:`Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© ${name}`,icon:"icon.png"});
  if(localStorage.getItem('mute_'+p)!=='yes'){
    const audio=document.getElementById("adhan");
    audio.src=localStorage.getItem('sound_'+p)||adhanSounds[0].file;
    audio.play();
  }
 },delay);
}

async function downloadAdhan(){
 const status=document.getElementById("downloadStatus");
 status.innerText="â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
 try{
  for(let a of adhanSounds){
   await fetch(a.file,{cache:"reload"});
  }
  localStorage.setItem("adhan_downloaded","yes");
  status.innerText="âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø£ØµÙˆØ§Øª Ø§Ù„Ø£Ø°Ø§Ù†";
 }catch{
  status.innerText="âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„";
 }
}

getLocation();
</script>

</body>
</html>
